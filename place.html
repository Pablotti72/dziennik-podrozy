<!DOCTYPE html>
<html lang="pl">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Miejsce</title>
Â  <link rel="stylesheet" href="style.css" />
Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
Â  <div class="back-link">
Â  Â  <a id="backLink" href="#">â† WrÃ³Ä‡ do mapy</a>
Â  </div>

Â  <main class="place-page">
Â  Â  <article id="place-content">
Â  Â  Â  <p>Åadowanie miejsca...</p>
Â  Â  </article>
Â  Â  <div id="place-map"></div>
Â  Â  <div id="place-photos" class="photo-gallery"></div>
Â  </main>

Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
Â  <script>
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const tripId = urlParams.get("tripId");
Â  Â  const placeId = urlParams.get("placeId");
Â  Â  const fromPage = urlParams.get("from"); // Odczytujemy nowy parametr

Â  Â  const backLink = document.getElementById("backLink");
Â  Â  if (fromPage === "edit") {
Â  Â  Â  backLink.href = "edit.html";
Â  Â  Â  backLink.textContent = "â† WrÃ³Ä‡ do edycji";
Â  Â  } else {
Â  Â  Â  backLink.href = `trip.html?id=${tripId}`;
Â  Â  Â  backLink.textContent = "â† WrÃ³Ä‡ do mapy";
Â  Â  }

Â  Â  const firebaseBaseUrl = "https://moj-dziennik-podrozy-default-rtdb.europe-west1.firebasedatabase.app";
Â  Â  const placeUrl = `${firebaseBaseUrl}/trips/${tripId}/places/${placeId}.json`;

Â  Â  const map = L.map("place-map").setView([54.5, -3.0], 8);
Â  Â  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

Â  Â  fetch(placeUrl)
Â  Â  Â  .then(res => res.json())
Â  Â  Â  .then(place => {
Â  Â  Â  Â  if (!place) {
Â  Â  Â  Â  Â  document.getElementById("place-content").innerHTML = "<p>âŒ Miejsce nie istnieje.</p>";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById("place-content").innerHTML = `
Â  Â  Â  Â  Â  <h1>${place.name}</h1>
Â  Â  Â  Â  Â  <p><strong>Kategoria:</strong> ${getCategoryLabel(place.category)}</p>
Â  Â  Â  Â  Â  <p><strong>Data wizyty:</strong> ${formatDate(place.date)}</p>
Â  Â  Â  Â  Â  <p>${place.description || ''}</p>
Â  Â  Â  Â  `;
Â  Â  Â  Â  
Â  Â  Â  Â  if (place.image) {
Â  Â  Â  Â  Â  const img = document.createElement("img");
Â  Â  Â  Â  Â  img.src = place.image;
Â  Â  Â  Â  Â  img.className = "place-image";
Â  Â  Â  Â  Â  document.getElementById("place-content").appendChild(img);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (place.lat && place.lng) {
Â  Â  Â  Â  Â  map.setView([place.lat, place.lng], 12);
Â  Â  Â  Â  Â  L.marker([place.lat, place.lng]).addTo(map).bindPopup(`<strong>${place.name}</strong>`).openPopup();
Â  Â  Â  Â  }

Â  Â  Â  Â  if (place.photos && place.photos.length > 0) {
Â  Â  Â  Â  Â  const gallery = document.getElementById("place-photos");
Â  Â  Â  Â  Â  place.photos.forEach(photo => {
Â  Â  Â  Â  Â  Â  const item = document.createElement("div");
Â  Â  Â  Â  Â  Â  item.className = "photo-item";
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  <img src="${photo.url}" alt="${photo.caption || ''}">
Â  Â  Â  Â  Â  Â  Â  <p>${photo.caption || ''}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  gallery.appendChild(item);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  })
Â  Â  Â  .catch(err => {
Â  Â  Â  Â  console.error("BÅ‚Ä…d Å‚adowania miejsca:", err);
Â  Â  Â  Â  document.getElementById("place-content").innerHTML = "<p>âŒ Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ miejsca.</p>";
Â  Â  Â  });

Â  Â  function formatDate(dateStr) {
Â  Â  Â  return dateStr ? new Date(dateStr).toLocaleDateString("pl-PL", { day: "numeric", month: "long", year: "numeric" }) : "Brak daty";
Â  Â  }

Â  Â  function getCategoryLabel(category) {
Â  Â  Â  const categories = {
Â  Â  Â  Â  "miasto": "ğŸ™ï¸ Miasto", "park": "ğŸŒ³ Park", "zabytek": "ğŸ›ï¸ Zabytek",
Â  Â  Â  Â  "muzeum": "ğŸ–¼ï¸ Muzeum", "hotel": "ğŸ¨ Hotel", "szczyt": "â›°ï¸ Szczyt",
Â  Â  Â  Â  "restauracja": "ğŸ½ï¸ Restauracja", "miejsce_widokowe": "ğŸŒ„ Miejsce widokowe",
Â  Â  Â  Â  "atrakcja_turystyczna": "ğŸ¯ Atrakcja turystyczna", "inny": "ğŸ”§ Inny"
Â  Â  Â  };
Â  Â  Â  return categories[category] || category;
Â  Â  }
Â  </script>
</body>
</html>
