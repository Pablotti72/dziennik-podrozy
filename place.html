<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Miejsce</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="back-link">
    <a id="backLink" href="#">← Wróć do wyprawy</a>
  </div>

  <main class="place-page">
    <article id="place-content">
      <p>Ładowanie...</p>
    </article>
  </main>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const tripId = urlParams.get("tripId");
    const placeId = urlParams.get("placeId");

    const backLink = document.getElementById("backLink");
    backLink.href = tripId ? `trip.html?id=${tripId}` : "index.html";

    const baseUrl = "https://moj-dziennik-podrozy-default-rtdb.europe-west1.firebasedatabase.app";
    const placeUrl = `${baseUrl}/trips/${tripId}/places/${placeId}.json`;

    fetch(placeUrl)
      .then(res => res.json())
      .then(data => {
        let galleryHtml = "";
        if (data.photos && data.photos.length > 0) {
          galleryHtml = `<div style="margin-top: 30px;"><h3>Galeria zdjęć</h3>`;
          data.photos.forEach(photo => {
            galleryHtml += `
              <div style="margin-bottom: 20px;">
                <img src="${photo.url.trim()}" style="width:100%; max-height:400px; object-fit:cover; border-radius:8px;" loading="lazy">
                <p style="margin:5px 0 0 0; font-size:14px; color:#555;"><em>${photo.caption || ''}</em></p>
              </div>`;
          });
          galleryHtml += `</div>`;
        }

        document.getElementById("place-content").innerHTML = `
          <h1>${data.name}</h1>
          <p><strong>Kategoria:</strong> ${data.category}</p>
          <p><strong>Data wizyty:</strong> ${formatDate(data.date)}</p>
          <img src="${data.image.trim()}" alt="Zdjęcie" style="width:100%; max-height:500px; object-fit:cover; border-radius:8px; margin:15px 0;">
          <p>${data.description || ''}</p>
          ${galleryHtml}
        `;
      });

    function formatDate(dateStr) {
      return dateStr ? new Date(dateStr).toLocaleDateString("pl-PL", { day: "numeric", month: "long", year: "numeric" }) : "Brak daty";
    }
  </script>
</body>
</html>
